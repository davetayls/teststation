<!DOCTYPE html>
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js not-ie"> <!--<![endif]-->
    <head>
		<meta charset="utf-8">
		
		<title>face recognition through webcam and canvas - Dave Taylor (@davetayls) Front-End Web Developer</title>
		<meta name="description" content="face recognition through webcam and canvas" />
		<meta name="viewport" content="width=device-width; initial-scale=1.0;">

		<link rel="stylesheet" href="http://the-taylors.org/css/core.css">
		<link rel="stylesheet" href="http://the-taylors.org/scripts/google-code-prettify/prettify.css" type="text/css" >

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="wrapper">
            <header><div id="pageHeader">
                <div id="logo">
                    <a href="/"><img src="/images/logo.gif" alt="Dave Taylor" /></a>
                </div>
                <div id="nav-primary">
                    <ul>
                        <li>
                            <a accesskey="c" href="#content">Jump to main content [Access key 'C']</a>
                        </li>
                        <li>
                            <a accesskey="0" href="/">Home</a>
                        </li>
                        <li>
                            <a href="/blog">Blog</a>
                        </li>
                        <li>
                            <a href="http://feed.the-taylors.org"><img src="/images/feed-icon-12x12-orange.gif" alt="" />&nbsp;Subscribe here</a>
                        </li>
                    </ul>
                </div>
            </div></header> <!-- #pageHeader -->
            <div id="contentWrapper">
                <h1>face recognition through webcam and canvas</h1>
			    <script src="webcam/jquery.webcam.js"></script>
<script src="ccv/ccv.js" type="text/javascript"></script>
<script src="ccv/face.js" type="text/javascript"></script>
<div id="camera"></div>
<canvas id="canvas" width="320" height="240"></canvas>
<div id="status"></div>
<div id="elapsed_time"></div>
<script type="text/javascript">

(function(){
    var ctx = null,
        pos = 0,
        image,
        canvas = document.getElementById("canvas");

    if (canvas.getContext) {
        ctx = document.getElementById("canvas").getContext("2d");
        ctx.clearRect(0, 0, 320, 240);

        var img = new Image();
        img.src = "/images/sprites.png";
        img.onload = function() {
            ctx.drawImage(img, 129, 89);
        };
        image = ctx.getImageData(0, 0, 320, 240);
    }

    $("#camera").webcam({
            width: 320,
            height: 240,
            mode: "callback",
            swffile: "webcam/jscam_canvas_only.swf",
            onTick: function(remain) {
                if (0 == remain) {
                    jQuery("#status").text("Cheese!");
                } else {
                    jQuery("#status").text(remain + " seconds remaining...");
                }
            },
            onSave: function(data) {

                var col = data.split(";");
                var img = image;

                for(var i = 0; i < 320; i++) {
                    var tmp = parseInt(col[i]);
                    img.data[pos + 0] = (tmp >> 16) & 0xff;
                    img.data[pos + 1] = (tmp >> 8) & 0xff;
                    img.data[pos + 2] = tmp & 0xff;
                    img.data[pos + 3] = 0xff;
                    pos+= 4;
                }

                if (pos >= 0x4B000) {
                    ctx.putImageData(img, 0, 0);
                    pos = 0;
                    window.detect();
                }
            },
            onCapture: function () {
                webcam.save();
            },
            debug: function (type, string) {
                jQuery("#status").html(type + ": " + string);
            },
            onLoad: function () {

                var cams = webcam.getCameraList();
                for(var i in cams) {
                    jQuery("#cams").append("<li>" + cams[i] + "</li>");
                }
            }
    });
 })();
function getCapture(){
    setTimeout(function(){
        window.webcam.capture();
    }, 1000);
}
getCapture();

function detect() {
	var image = new Image();
	// var url = document.getElementById("image").value;
	// window.location.hash = "#" + encodeURIComponent(url);
	// image.src = "loader.php?src=" + encodeURIComponent((url.substr(0, 7).toLowerCase() == "http://") ? url : "http://" + url);
	document.getElementById("elapsed_time").innerHTML = "Loading image from web ...";
	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");
    document.getElementById("elapsed_time").innerHTML = "Detecting ...";
    /* call main detect_objects function */
    var elapsed_time = (new Date()).getTime();
    var comp = ccv.detect_objects({ "canvas" : canvas,
                                    "cascade" : cascade,
                                    "interval" : 5,
                                    "min_neighbors" : 1 });

    document.getElementById("elapsed_time").innerHTML = "Elapsed time : " + ((new Date()).getTime() - elapsed_time).toString() + "ms";
    // resizeCanvas(image, canvas);
    // ctx.drawImage(image, 0, 0);
    ctx.lineWidth = 3;
    ctx.strokeStyle = "#f00";
    /* draw detected area */
    for (var i = 0; i < comp.length; i++){
        ctx.strokeRect(comp[i].x, comp[i].y, comp[i].width, comp[i].height);
    }
    getCapture();
}

function detectAsync() {
	document.getElementById("elapsed_time").innerHTML = "Loading image ...";
	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");

    var elapsed_time = (new Date()).getTime();
    document.getElementById("elapsed_time").innerHTML = "Detecting ...";
    ccv.detect_objects({ 
        "canvas" : canvas,
        "cascade" : cascade,
        "interval" : 5,
        "min_neighbors" : 1,
        "async" : true,
        "worker" : 1 
    })(function (comp) {
        document.getElementById("elapsed_time").innerHTML = "Elapsed time : " + ((new Date()).getTime() - elapsed_time).toString() + "ms";
        ctx.lineWidth = 3;
        ctx.strokeStyle = "#f00";
        /* draw detected area */
        for (var i = 0; i < comp.length; i++){
            ctx.strokeRect(comp[i].x, comp[i].y, comp[i].width, comp[i].height);
        }
        getCapture();
    });
}

</script>

            </div>
        </div>
        <footer><div id="pageFooter">
            <p> David Taylor, <br/> Front-end interface web developer</p>
            <address>
                87 Lewin Rd,<br />
                London,<br />
                SW16 6JX
            </address>
            <p> Phone: 0754 081 7008 </p>
            <ul>
                <li> <a href="pdf/David_Taylor_CV_07540817008.pdf">Download CV</a> </li>
                <li> <a href="/blog">Blog</a> </li>
                <li> <a href="http://feed.the-taylors.org">Blog RSS Feed</a> </li>
                <li> <a href="http://twitter.com/davetayls">Twitter @davetayls</a> </li>
                <li> <a href="http://www.linkedin.com/in/davidtaylorlondon">LinkedIn</a> </li>
            </ul>
    
        </div></footer><!-- #pageFooter -->

            <script type="text/javascript" src="http://the-taylors.org/scripts/google-code-prettify/prettify.js"></script>
            
			<script type="text/javascript">
			  var _gaq = _gaq || [];
			  _gaq.push(['_setAccount', 'UA-4421586-2']);
			  _gaq.push(['_trackPageview']);
			
			  (function() {
			    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			  })();
			</script>
        </body>
    </html>
